---
title: "Tortuosity analysis of cauterized mutants"
author: "Bruno C. Vellutini"
date: "`r format(Sys.time(), '%d %B, %Y')`"
creation: May 26, 2021
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE, cache = FALSE)
library(ggplot2)
```


## Load measurements

```{r load}
# Get list of measurement files
datafiles <- list.files(path = "3-tortuosity", pattern = "*.txt")

# Create placeholder dataframe for all datasets
datasets <- data.frame()

# Datasets to be skipped due to artifacts
discard <- c(
  "STR_DUP_btd_dorsal_cauterized_homozygous_2021-03-04_E1_equator.1.txt" # Dirt on surface
)

# Loop over datafiles
for (d in 1:length(datafiles)) {
  # Filename
  dataname <- datafiles[d]
  if (dataname %in% discard) {
    next
  }
  # Import data excluding additional lines (nrow > 20)
  tmpdata <- read.delim(paste0("3-tortuosity/", dataname), nrows = 20)
  # Create dataframe
  tmpdf <- data.frame(
    timepoint=paste0("TP", sprintf("%02d", tmpdata$Skeleton.ID)),
    minute=(tmpdata$Skeleton.ID - 1) * 2.63,
    length=tmpdata$Branch.length,
    tortuosity=tmpdata$Branch.length / tmpdata$Euclidean.distance,
    delta_length=(tmpdata$Branch.length - tmpdata$Branch.length[1])
    )
  # Split filename to parse variables
  namesplit <- strsplit(dataname, "_")
  stock <- namesplit[[1]][3]
  sample <- namesplit[[1]][5]
  embryo <- paste(namesplit[[1]][7], namesplit[[1]][8], sep = "_")
  sidestr <- namesplit[[1]][9]
  if (sidestr == "equator.1.txt") {
    side <- "right"
  } else if (sidestr == "equator.2.txt") {
    side <- "left"
  }
  # Add variables as columns
  tmpdf$stock <- stock
  tmpdf$sample <- sample
  tmpdf$embryo <- embryo
  tmpdf$side <- side
  # Bind to placeholder dataframe
  datasets <- rbind(datasets, tmpdf)
}

```

```{r plot}
# Plot stocks together
ggplot(datasets, aes(minute, tortuosity, color = sample, group = interaction(minute, sample))) + geom_boxplot(show.legend = FALSE) + geom_point(alpha = 0.8, position = position_dodge(width = 2), show.legend = FALSE) + labs(x = "minutes", y = "tortuosity") + scale_color_manual(values=c("#0072b2", "#d55e00")) + theme_classic()
ggsave("tortuosity_all_boxplot.png")
ggplot(datasets, aes(minute, tortuosity, color = sample)) + geom_smooth(span = 0.3, show.legend = FALSE) + labs(x = "minutes", y = "tortuosity") + scale_color_manual(values=c("#0072b2", "#d55e00")) + theme_classic()
ggsave("tortuosity_all_smooth.png", width = 7, height = 3)

# Plot stocks separately
ggplot(datasets, aes(minute, tortuosity, color = sample, group = interaction(minute, sample))) + geom_boxplot(show.legend = FALSE) + geom_point(position = position_dodge(width = 2), show.legend = FALSE) + facet_wrap(~stock) + labs(x = "minutes", y = "tortuosity") + scale_color_manual(values=c("#0072b2", "#d55e00")) + theme_classic()
ggsave("tortuosity_facet_boxplot.png")
ggplot(datasets, aes(minute, tortuosity, color = sample)) + geom_smooth(span = 0.3, show.legend = FALSE) + facet_wrap(~stock) + labs(x = "minutes", y = "tortuosity") + scale_color_manual(values=c("#0072b2", "#d55e00")) + theme_classic()
ggsave("tortuosity_facet_smooth.png")

```


