---
title: "Cephalic furrow ablations"
author: "Bruno C. Vellutini"
date: "`r format(Sys.time(), '%d %B, %Y')`"
creation: April 06, 2021
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE, cache = FALSE)
knitr::opts_knit$set(root.dir = "~/Dropbox/Projects/Cephalic_furrow/7-Paper/1-analyses/ablations")
setwd("~/Dropbox/Projects/Cephalic_furrow/7-Paper/1-analyses/ablations")
library(ggplot2)
library(ggbeeswarm)
```

## Description

Laser ablations around the cephalic furrow surroundings to check if there's an
active pull force. Experiments and initial plots performed by Marina. I'm using
the data to re-plot in a different way.

## Load measurements

```{r load}
# Load raw ROI measurements from ImageJ
ablations <- read.csv("ablation-data.csv", stringsAsFactors = TRUE)
levels(ablations$Stage) <- c("early", "mid", "late")
```

## Summarize

```{r summary}
# Calculate summaries per sample
print("ANTERIOR ABLATIONS")
by(ablations[ablations$Position == "anterior", c("Velocity")], ablations[ablations$Position == "anterior",]$Stage, summary)
print("POSTERIOR ABLATIONS")
by(ablations[ablations$Position == "posterior", c("Velocity")], ablations[ablations$Position == "posterior",]$Stage, summary)

capture.output(
  print("ANTERIOR ABLATIONS"),
  by(ablations[ablations$Position == "anterior", c("Velocity")], ablations[ablations$Position == "anterior",]$Stage, summary),
  print("POSTERIOR ABLATIONS"),
  by(ablations[ablations$Position == "posterior", c("Velocity")], ablations[ablations$Position == "posterior",]$Stage, summary),
  file = "summary.txt"
)
```

```{r stage}
# Plot mean length of cephalic furrow per embryo (right/left sides)
#ggplot(means[means$Velocity > 0,], aes(Stage, Velocity, group = Distance, fill = Position)) +
ggplot(ablations, aes(Stage, Velocity, )) +
  geom_boxplot(aes(color = "#e69f03", fill = "#e69f03"), show.legend = FALSE, alpha = 0.5, outlier.shape = NA, width = 0.9, position = position_dodge(width = 1.0)) +
  geom_point(alpha = 0.8, size = 3, show.legend = FALSE, position = position_beeswarm(priority = "descending", dodge.width = 1.0, cex = 2)) +
#ggplot(means, aes(Distance, Velocity, group = Distance)) +
#ggplot(means, aes(Distance, Velocity, color = Stage)) +
  #geom_violin(draw_quantiles = c("0.5"), show.legend = FALSE, trim = TRUE, alpha = 0.7, fill = "#e69f03", scale = "area", adjust = 2) +
  #geom_boxplot(draw_quantiles = c("0.5"), show.legend = FALSE, trim = TRUE, alpha = 0.7, fill = "#e69f03", scale = "area", adjust = 2) +
  #geom_bar(stat = "summary", fun = "mean", alpha = 0.7, width = 0.5, fill = "#e69f03", show.legend = FALSE) +
  #geom_smooth(span = 0.8, show.legend = FALSE, aes(fill = "#e69f03", colour = "#e69f03")) +
  #geom_pointrange(aes(ymin=Velocity-SD, ymax=Velocity+SD), position = position_quasirandom(width = 0.15, bandwidth = 0.1), alpha = 0.5, show.legend = FALSE) +
  #geom_quasirandom(size = 2, width = 1.0, alpha = 0.8, show.legend = FALSE) +
  #geom_errorbar(aes(ymin=Mean-SD, ymax=Mean+SD), show.legend = FALSE)+
  #geom_jitter(alpha = 0.8, width = 0.1, size = 2, show.legend = FALSE) +
  #geom_point(alpha = 0.8, width = 0.1, size = 2, show.legend = FALSE) +
  #geom_pointrange(aes(ymin=Mean-SD, ymax=Mean+SD), position = position_jitterdodge(jitter.width = 0.3), show.legend = FALSE)+
  #geom_pointrange(aes(ymax=Velocity+Error), position = position_quasirandom(width = 0.15, bandwidth = 0.1), show.legend = FALSE) +
  #scale_y_continuous(limits = c(0, 0.26)) +
  #facet_wrap(~Stage) +
  labs(x = "stage", y = "velocity (µm/s)") +
  scale_fill_manual(values=c("#e69f03", "#56b4e9")) +
  scale_color_manual(values=c("#e69f03", "#56b4e9")) +
  scale_y_continuous(limits = c(0, 0.25)) +
  theme_classic(base_family = "DejaVu Sans") +
  theme(text = element_text(size = 30),
        panel.background = element_rect(colour = "black", size=1))
```

```{r means}
# Mean of CF length per embryo
embryo_mean <- aggregate(ablations$Velocity, list(ablations$Embryo), mean)
colnames(embryo_mean) <- c("Embryo", "Velocity")

# Standard deviation of CF length per embryo
embryo_sd <- aggregate(ablations$Velocity, list(ablations$Embryo), sd)
colnames(embryo_sd) <- c("Embryo", "SD")

# Get sample information
samples <- unique(ablations[, c("Embryo", "Stage", "Position", "Distance")])

# Merge datasets
means <- merge(samples, embryo_mean, by = "Embryo", all.x = TRUE)
means <- merge(means, embryo_sd, by = "Embryo", all.x = TRUE)
```

```{r outliers}
# Exclude outliers
means[means$Distance <= 20 & means$Distance > 0,]$Distance <- 20
means[means$Distance <= 40 & means$Distance > 20,]$Distance <- 40
means[means$Distance >= -20 & means$Distance < 0,]$Distance <- -20
means[means$Distance >= -40 & means$Distance < -20,]$Distance <- -40
means$Distance <- as.factor(means$Distance)
```

## Plot overview

```{r distance}
ggplot(means, aes(Distance, Velocity)) +
#ggplot(means[means$Velocity > 0,], aes(Distance, Velocity)) +
  geom_vline(xintercept = 0, size = 0.5, linetype = "dashed", alpha = 0.5, colour = "black") +
  geom_smooth(span = 0.8, show.legend = FALSE, aes(fill = "#e69f03", colour = "#e69f03")) +
  geom_point(alpha = 0.8, size = 3, show.legend = FALSE) +
  labs(x = "distance from initiator (µm)", y = "velocity (µm/s)") +
  facet_wrap(~Stage) +
  scale_fill_manual(values=c("#e69f03")) +
  scale_color_manual(values=c("#e69f03")) +
  #scale_x_continuous(limits = c(-50, 50)) +
  scale_y_continuous(limits = c(0, 0.4)) +
  theme_classic(base_family = "DejaVu Sans") +
  theme(text =  element_text(size = 40),
        strip.background = element_blank(),
        strip.placement = "outside",
        strip.text.x = element_text(size = 45),
        panel.background = element_rect(colour = "black", size=1),
        panel.spacing = unit(3, "lines"))
ggsave("3-plots/recoil-velocity.png", width = 14, height = 7)
ggsave("3-plots/recoil-velocity.svg", width = 14, height = 7)
```

```{r stage}
ggplot(means, aes(Distance, Velocity, group = Distance, fill = Position)) +
  #geom_vline(xintercept = 0, size = 0.5, linetype = "dashed", alpha = 0.5, colour = "black") +
  geom_boxplot(aes(color = Position), show.legend = FALSE, alpha = 0.5, outlier.shape = NA, width = 0.8, position = position_dodge(width = 1.0)) +
  geom_point(alpha = 0.8, size = 5, show.legend = FALSE, position = position_beeswarm(priority = "descending", dodge.width = 1.0, cex = 5)) +
  #geom_pointrange(aes(ymin=Velocity-SD, ymax=Velocity+SD), position = position_quasirandom(width = 0.15, bandwidth = 0.1), alpha = 0.5, show.legend = FALSE) +
  scale_y_continuous(limits = c(0, 0.21)) +
  facet_wrap(~Stage) +
  labs(x = "stage", y = "velocity (µm/s)") +
  scale_fill_manual(values=c("#009966", "#cc79a7")) +
  scale_color_manual(values=c("#009966", "#cc79a7")) +
  theme_classic(base_family = "DejaVu Sans") +
  theme(text = element_text(size = 45),
        strip.background = element_blank(),
        strip.placement = "outside",
        strip.text.x = element_text(size = 55),
        panel.background = element_rect(colour = "black", size=1))
ggsave("3-plots/recoil-velocity.png", width = 14, height = 7)
ggsave("3-plots/recoil-velocity.svg", width = 14, height = 7)
```

